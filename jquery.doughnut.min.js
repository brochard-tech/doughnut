!function(t){var e={size:80,segmentSize:6,fontColor:"white",foregroundColor:"#181516",animated:!1,duration:3e3,valueDisplayed:null,showTotalValue:!0,showLabelValue:!0,value:0,maxValue:null,color:"#3CB4F0",name:"",unit:"",textPos:"auto",segments:null,_canvas:null,_total:0,_step:0,_currentSegmentValue:0,_currentSegment:0,_valueDisplayed:!1,init:function(e,i){for(var s in i)this[s]=i[s];return this.$parent=e,this._canvas=document.createElement("canvas"),this.$parent.css("position","relative"),t(this._canvas).attr("width",this.size),t(this._canvas).attr("height",this.size),t(this._canvas).css({width:this.size,height:this.size,position:"absolute",left:"50%","margin-left":-this.size/2+"px"}),this.$parent.html(this._canvas),this.$parent.height(this.size),this.initDraw(),this.segments?this.determineTotalValue():(this.maxValue=null==this.maxValue?this.value:this.maxValue,this._total=this.maxValue),this},reinit:function(){this._currentSegmentValue=0,this._valueDisplayed=!1,this._currentSegment=0,this.clearDraw(),this.$parent.find(".doughnut-values").remove()},animate:function(){this.reinit();var t=this;switch(this.animated){case!0:this.$parent.prop("Angle",0).animate({Angle:t.getMaxAngle()},{duration:t.duration,queue:!1,step:function(e){t.draw(Math.ceil(e))}});break;default:this.draw()}},determineTotalValue:function(){this._total=0,this._currentValue=0;for(var t=0;t<this.segments.length;t++){var e=this.segments[t];this._total+=parseInt(e.value||0)}},getStepSegment:function(t){var e=360;if(this.segments){var i=this.segments[this._currentSegment];if(i){var s=this._currentSegmentValue+i.value/this._total*e,a=t/e*e;a>s&&(this._currentSegmentValue=s,i=this.segments[++this._currentSegment])}}return i},getContext:function(){return this.ctx||(this.ctx=this._canvas.getContext("2d")),this.ctx},displayValues:function(){for(var t=0,e=0;e<this.segments.length;e++){var i=this.segments[e];this.displayValue(i,t),t+=i.value/this._total*360}},displayValue:function(t,e){var i=this.size/2,s=t.value/this._total*360,a=(e||0)+s/2;switch(t.textPos){case"top":var n=0,h=-i,l=.5,r=1;break;case"bottom":var n=0,h=i,l=.5,r=0;break;case"left":var n=-i,h=0,l=1,r=.5;break;case"right":var n=i,h=0,l=0,r=.5;break;default:var n=Math.floor(Math.cos(this.getRadians(a-90))*i),h=Math.floor(Math.sin(this.getRadians(a-90))*i),l=.5,r=.5;0>n?l=1:n>0&&(l=0),0>h?r=1:h>0&&(r=0)}this.displayValueByPos(t,n,h,l,r),this._valueDisplayed=!0},displayValueByPos:function(e,i,s,a,n){if(!e.value||!this.showLabelValue)return!1;var h=document.createElement("div"),l=this.size/2;h.className="doughnut-values",h.style.display="inline-block",h.innerHTML="<span class='doughnut-value'>"+(e.value||0).toString()+" "+this.unit+"</span><br /><span class='doughnut-name'>"+(e.name||"")+"</span>",t(h).css({opacity:0,left:"50%",position:"absolute","text-align":"center"}),this.$parent.append(h),a=t(h).width()*a,n=t(h).height()*n,t(h).css({"margin-left":i-a+"px",top:l+s-n+"px"}),t(h).animate({opacity:1},300)},getRadians:function(t){return t*Math.PI/180},getMaxAngle:function(){if(this.segments&&this.segments.length)return 360;var t=Math.floor(this.value/this.maxValue*360);return t},initDraw:function(t){var e=this.getContext(),i=this.size/2,s=i-this.segmentSize;if(this.clearDraw(),e.beginPath(),e.fillStyle=this.foregroundColor,e.arc(i,i,s,0,2*Math.PI),e.fill(),e.closePath(),"delay"==this.animated||!this.showTotalValue)return!1;var a=0;a=null!==this.valueDisplayed?this.valueDisplayed:this.segments?this._total.toString():this.value.toString();var n=a;void 0!==t&&(n=Math.floor(t/this.getMaxAngle()*a).toString(),n=isNaN(n)?0:n),e.font="25px Arial",e.fillStyle=this.fontColor,e.textAlign="center",e.textBaseline="middle",e.fillText(n,i-this.segmentSize/4,i-this.segmentSize/4)},clearDraw:function(){var t=this.getContext();t.clearRect(0,0,this.size,this.size)},draw:function(t){if(!this._canvas)return!1;this.initDraw(t);var e=void 0!==t;if("delay"==this.animated)return!1;if(this.segments){for(var i=0,s=e?this.getStepSegment(t):null,a=0;a<(e?this._currentSegment:this.segments.length);a++){var n=this.segments[a],h=n.value/this._total*360;this.drawSegment(i,n),i+=h}e&&s&&(this.drawSegment(this._currentSegmentValue,s,t),360!=t||this._valueDisplayed||this.displayValues())}else{var n={color:this.color,value:this.value,name:this.name,textPos:this.textPos};this.drawSegment(0,n,t),t!=this.getMaxAngle()||this._valueDisplayed||this.displayValue(n)}e||(this.segments?this.displayValues():this.displayValue(n))},drawSegment:function(t,e,i){var s=this.getContext(),a=360,n=e.value/this._total*a,h=this.size/2-this.segmentSize/2,l=void 0!==i?n+t-i:0;s.beginPath(),s.lineWidth=this.segmentSize,s.strokeStyle=e.color||"#3CB4F0",s.arc(this.size/2,this.size/2,h,this.getRadians(t-90),this.getRadians(t+n-90-(0>=l?0:l))),s.stroke(),s.closePath()}};t.fn.doughnut=function(i){if("animate"!==i){i=i||{};{var s=Object.create(e);i.duration||3e3}s.init(this,i),t(this).prop("doug",s),s.animate()}else{var s=t(this).prop("doug");s.animated&&(s.animated=!0,s.animate())}}}(jQuery);